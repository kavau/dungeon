<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Dungeon Crawler</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="info">
        <h1 id="current-level-name">Level 1</h1>
        <p id="health">Health: 100/100</p>
        <p id="madness" style="color: #d66; display: none;">Madness: 0/100</p>
        <p id="wealth">Wealth: 0 gold</p>
        <p style="font-size: 12px; color: #888; margin-top: 10px;">Press H for Help | Press U to Use Amulet</p>
    </div>
    
    <div id="damage-flash"></div>
    
    <div id="game-over">
        <h1>GAME OVER</h1>
        <p>You were defeated!</p>
        <p>Reload the page to try again</p>
    </div>

    <div id="intro-screen">
        <h1>Awakening</h1>
        <p>You wake up in a cold, damp darkness. A throbbing pain pulses in your skull—the aftermath of a blow you don't remember taking.</p>
        <p>Beside you lies a flickering torch. You grasp it, the warmth a small comfort against the chill.</p>
        <p>The light reveals a massive cavern. In its center looms the rotting carcass of a giant wyrm, arrows protruding from its scales. Around it lie the broken bodies of adventurers... your comrades?</p>
        <p>Memory fails you, but instinct screams one thing:</p>
        <p class="highlight">Find the way out.</p>
        <p class="press-key">Press any key to begin</p>
    </div>

    <div id="win-screen">
        <h1>Freedom</h1>
        <p>The cool night air hits your face as you climb the final rung. You pull yourself up, muscles aching, lungs burning, but alive.</p>
        <p>Below you, the darkness of the dungeon remains, holding its secrets and its dead. But you... you are free.</p>
        <p>The stars above have never looked so bright.</p>
        <p class="highlight">You have escaped!</p>
        <p class="press-key">Press any key to play again</p>
    </div>

    <div id="level-screen" style="display: none;">
        <h1 id="level-title">Level Title</h1>
        <div id="level-desc-container">
            <p id="level-desc">Level description...</p>
        </div>
        <p class="press-key">Press any key to continue</p>
    </div>
    
    <div id="debug-window"></div>
    
    <div id="floating-labels"></div>
    
    <div id="message-log"></div>

    <div id="settings-menu" style="display: none;">
        <h2>Visual Settings</h2>


        <div class="settings-row">
            <div class="slider-container compact">
                <label for="brightness-slider">Brightness</label>
                <input type="range" id="brightness-slider" min="0" max="2.0" step="0.1" value="1.0">
                <span id="brightness-val">1.0</span>
            </div>
            <div class="slider-container compact">
                <label for="contrast-slider">Contrast</label>
                <input type="range" id="contrast-slider" min="0" max="2.0" step="0.1" value="1.0">
                <span id="contrast-val">1.0</span>
            </div>
        </div>
        
        <div class="settings-row">
            <div class="slider-container compact">
                <label for="distance-slider">View Distance</label>
                <input type="range" id="distance-slider" min="10" max="100" step="5" value="40">
                <span id="distance-val">40</span>
            </div>
            <div class="slider-container compact">
                <div style="display: flex; justify-content: space-between; width: 100%;">
                    <label for="ambient-slider">Ambient</label>
                    <input type="checkbox" id="ambient-toggle" checked>
                </div>
                <input type="range" id="ambient-slider" min="0.0" max="1.0" step="0.05" value="0.0">
                <span id="ambient-val">0.0</span>
            </div>
        </div>
        
        <!-- Exposure -->
        <div style="display: flex; align-items: center; justify-content: space-between; margin: 8px 0 4px;">
            <h3 class="settings-header" style="color: #ffffff; margin: 0; border: none;">Eye Sensitivity</h3>
            <div style="display: flex; align-items: center;">
                <label for="auto-exposure-toggle" style="font-size: 12px; margin-right: 5px; color: #aaa;">Auto</label>
                <input type="checkbox" id="auto-exposure-toggle" checked>
            </div>
        </div>
        <div class="settings-row">
            <div class="slider-container compact" style="position: relative; margin-bottom: 12px;">
                <input type="range" id="exposure-slider" min="0.1" max="5.0" step="0.1" value="1.0" style="margin-bottom: 2px;">
                <span id="exposure-val">1.0</span>
                
                <!-- Markers -->
                <div style="position: absolute; top: 6px; left: 0; width: 100%; height: 10px; pointer-events: none;">
                    <!-- 1.0 (Torch On) -->
                    <div style="position: absolute; left: calc(18.4% + 6px); transform: translateX(-50%); display: flex; flex-direction: column; align-items: center;">
                        <div style="width: 2px; height: 6px; background: #999;"></div>
                        <span style="font-size: 8px; color: #ddd; white-space: nowrap; margin-top: 1px;">Torchlight</span>
                    </div>
                    <!-- 3.0 (Torch Off) -->
                    <div style="position: absolute; left: calc(59.2% - 2px); transform: translateX(-50%); display: flex; flex-direction: column; align-items: center;">
                        <div style="width: 2px; height: 6px; background: #999;"></div>
                        <span style="font-size: 8px; color: #ddd; white-space: nowrap; margin-top: 1px;">Darkness</span>
                    </div>
                </div>
            </div>
        </div>
        
        <hr style="border-color: #555; margin: 10px 0;">

        <!-- Player Torch -->
        <div style="display: flex; align-items: center; justify-content: space-between; margin: 8px 0 4px;">
            <h3 class="settings-header" style="color: #ffaa00; margin: 0; border: none;">Player Torch</h3>
            <input type="checkbox" id="torch-toggle" checked>
        </div>
        <div class="settings-row">
            <div class="slider-container compact">
                <label for="torch-bright-slider">Brightness</label>
                <input type="range" id="torch-bright-slider" min="0" max="5.0" step="0.1" value="3.0">
                <span id="torch-bright-val">3.0</span>
            </div>
            <div class="slider-container compact">
                <label for="torch-range-slider">Range</label>
                <input type="range" id="torch-range-slider" min="0" max="50" step="1" value="24">
                <span id="torch-range-val">24</span>
            </div>
        </div>

        <!-- Fireflies -->
        <div style="display: flex; align-items: center; justify-content: space-between; margin: 8px 0 4px;">
            <h3 class="settings-header" style="color: #aaffaa; margin: 0; border: none;">Fireflies</h3>
            <input type="checkbox" id="firefly-toggle" checked>
        </div>
        <div class="settings-row">
            <div class="slider-container compact">
                <label for="firefly-bright-slider">Brightness</label>
                <input type="range" id="firefly-bright-slider" min="0" max="5.0" step="0.1" value="2.5">
                <span id="firefly-bright-val">2.5</span>
            </div>
            <div class="slider-container compact">
                <label for="firefly-range-slider">Range</label>
                <input type="range" id="firefly-range-slider" min="0" max="20" step="0.5" value="8.0">
                <span id="firefly-range-val">8.0</span>
            </div>
        </div>

        <!-- Mushrooms -->
        <div style="display: flex; align-items: center; justify-content: space-between; margin: 8px 0 4px;">
            <h3 class="settings-header" style="color: #44ff44; margin: 0; border: none;">Mushrooms</h3>
            <input type="checkbox" id="shroom-toggle" checked>
        </div>
        <div class="settings-row">
            <div class="slider-container compact">
                <label for="shroom-bright-slider">Brightness</label>
                <input type="range" id="shroom-bright-slider" min="0" max="5.0" step="0.1" value="1.5">
                <span id="shroom-bright-val">1.5</span>
            </div>
            <div class="slider-container compact">
                <label for="shroom-range-slider">Range</label>
                <input type="range" id="shroom-range-slider" min="0" max="30" step="1" value="10">
                <span id="shroom-range-val">10</span>
            </div>
        </div>

        <!-- Moss -->
        <div style="display: flex; align-items: center; justify-content: space-between; margin: 8px 0 4px;">
            <h3 class="settings-header" style="color: #66ff88; margin: 0; border: none;">Moss</h3>
            <input type="checkbox" id="moss-toggle" checked>
        </div>
        <div class="settings-row">
            <div class="slider-container compact">
                <label for="moss-bright-slider">Brightness</label>
                <input type="range" id="moss-bright-slider" min="0" max="5.0" step="0.1" value="0.5">
                <span id="moss-bright-val">0.5</span>
            </div>
            <div class="slider-container compact">
                <label for="moss-range-slider">Range</label>
                <input type="range" id="moss-range-slider" min="0" max="20" step="0.5" value="5.0">
                <span id="moss-range-val">5.0</span>
            </div>
        </div>

        <button id="reset-settings" style="margin-top: 10px; width: 100%; padding: 6px; background: #444; color: #fff; border: 1px solid #666; cursor: pointer; font-size: 12px;">Reset to Default</button>
    </div>

    <div id="manual-screen" style="display: none;">
        <h2>Adventurer's Manual</h2>
        <div class="manual-content">
            <h3>Controls</h3>
            <ul>
                <li><strong>Arrow Keys:</strong> Move and Turn</li>
                <li><strong>Shift + Left/Right:</strong> Strafe</li>
                <li><strong>Shift + Down:</strong> Turn Around (180°)</li>
                <li><strong>A:</strong> Attack</li>
                <li><strong>E:</strong> Interact (Doors)</li>
                <li><strong>J:</strong> Toggle Journal</li>
                <li><strong>Space:</strong> Wait Turn</li>
                <li><strong>Hold Alt:</strong> Show visible items</li>
                <li><strong>V:</strong> Visual Settings</li>
                <li><strong>H:</strong> Toggle Help/Manual</li>
            </ul>
            <h3>Gameplay</h3>
            <ul>
                <li><strong>Light:</strong> Your torch is your life. It burns out over time. Find new torches dropped by monsters or in chests.</li>
                <li><strong>Combat:</strong> Monsters move when you move. Attack them before they attack you.</li>
                <li><strong>Journal:</strong> Collect scattered pages to uncover the story of the lost expedition.</li>
                <li><strong>Goal:</strong> Find the ladder to ascend to the next level. Escape the dungeon.</li>
            </ul>
        </div>
        <p class="press-key">Press H to close</p>
    </div>

    <div id="journal-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center;">
        <div id="journal-book" style="width: 600px; height: 700px; background: #eec; padding: 40px; border-radius: 5px; box-shadow: 0 0 20px rgba(0,0,0,0.8); overflow-y: auto; font-family: 'Times New Roman', serif; position: relative;">
            <h2 style="text-align: center; font-size: 32px; border-bottom: 2px solid #543; padding-bottom: 10px; margin-bottom: 20px; color: #543;">Explorer's Journal</h2>
            <div id="journal-content">
                <!-- Pages will be injected here -->
                <p style="text-align: center; font-style: italic; color: #888;">No pages found yet...</p>
            </div>
            <div style="margin-top: 30px; text-align: center; color: #866; font-size: 14px;">Press 'J' or 'ESC' to close</div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script type="module" src="main.js"></script>
</body>
</html>
